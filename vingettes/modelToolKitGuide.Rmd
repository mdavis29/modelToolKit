---
title: "modelToolKitGuide"
author: "Matthew Davis"
date: "August 4, 2017"
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---
#### Predictive Model Preformance 

Get predictive model prefomance by a catagory.  Check to see if a model is preforming differently in by a group or catagory

```{r setup, message=FALSE, comment=''}
try(detach(package:modelToolKit, unload = TRUE))
library(modelToolKit)
library(rpart)
data(iris)
set.seed(2012)
fit<-rpart(Species~., iris)
km<-kmeans(iris[,1:4], 3)
preds<-predict(fit, iris, type = 'class')
obs<-iris[,'Species']
cats<-as.factor(km$cluster)
preformanceByCatagory(preds, obs, cats)

```

#### Cluster Model Utilities 

Assign new clusters using kmeans to new data 

```{r }
head(predictKmeans(km, iris))
```

Find differences between data frames
```{r}

find2dfDiffs(iris[,1:4],iris[, 1:4]+.12)
```
Find the optimal number of clusters
```{r, }
findClusters(iris[,1:4])
```
#### Data Frame and Factor Utlities 

Find differences between two factors 
```{r}
set.seed(12012)
x = as.factor(rep(c('a','b','c' , 'a'), 10))
y = as.factor(sample(c('a','b','c'), 30, replace = TRUE))
z<-factorDiffs(x,y)
z

```

Find difference between all factors in two data frames

```{r}
size = 100
df1<-data.frame(x = as.factor(sample(c('a','b','c' ,'d'),size, replace = TRUE)),
                y = as.factor(sample(c('a','b','c','a') ,size, replace = TRUE)))

df2<-data.frame(x = as.factor(sample(c('a','b','c','c'),size, replace = TRUE)),
                y = as.factor(sample(c('a','b','c','b'), size, replace = TRUE)))

dataFrameFactDiffs(df1, df2)
```



Level Matcher Apply one set of levels to another data frame
In the case where levels are in the new data frame, but not in the original, the values are mapped to <NA>

```{r}
data1<-data.frame(x = as.factor(rep(c('a', 'b'), 10)), 
                  y =  as.factor(rep(c('c', 'd'), 10)))

data2<-data.frame(x = as.factor(rep(c('a', 'b', 'GG'), 10)), 
                  y =  as.factor(rep(c('c', 'FF','GG'), 10)))
str(levelMatcher(newData = data2, oldData = data1))
```
##### Variable Contributions


Generate a predictive model for housing price over the mean housing price using the Sacramento data set inside caret. This model will be used to demonstrate logistic difference between observation functions


```{r , message = FALSE}
library(caret)

data("Sacramento")
predVars<-c('city', 'beds', 'sqft','baths', 'type')
rd<-Sacramento[, predVars]
rd$class<-as.factor(ifelse(Sacramento$price > mean(Sacramento$price),1,0 ))
f<-formula(class~.)
fit<-glm(f, rd, family = 'binomial')

preds<-predict(fit, rd, type = 'response' )
```
check model preformance 
```{r}
cutoff = .5
postResample(as.factor(ifelse(preds > cutoff,1,0)), rd$class)
```
Find the different factor contributions between a reference observation and a test observation
```{r}
logisticDifference(fit,rd[2,predVars], mydata =  rd )
```

Find the different factor contributions between a reference observation and a test data frame of observations

```{r}
x<-logisticDifferenceDf(fit,rd[1:2,predVars], mydata =  rd, verbose = TRUE )
print(x)
```


NA to unknow and NA to Value transform
```{r}
# create some data
mydata<-data.frame(x1 = rep(c('a', 'b', NA, 'c'),10),
                   x2 = rep(c('a', 'b', NA, 'c'),10),
                   y1 = rep(c(1,2,3,NA), 10),
                   y2 = rep(c(1,2,3,NA), 10))

NAtoValueDf(mydata, numVal = 0 , newLevName = 'unKnown' )

```


